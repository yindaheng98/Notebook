# nodejsé‡è¦ç‰¹æ€§

## å›è°ƒå‡½æ•°

å¦‚æœçœ‹è§æŸä¸ªå‡½æ•°å®šä¹‰é•¿ä¸‹é¢è¿™æ ·ğŸ‘‡é‚£å®ƒå°±åº”è¯¥æ˜¯ä¸ªå¸¦å›è°ƒçš„å‡½æ•°ã€‚è¿™ç±»çš„å‡½æ•°ä¸€èˆ¬ä¸ºjså†…ç½®ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™éƒ½æ˜¯ä½œä¸ºä¸€ä¸ªæ–°çº¿ç¨‹è¿è¡Œçš„ã€‚

```javascript
function some_function(param1,param2,callback){}
```

callbacké‡Œé¢å†™ä¸Šä¸€ä¸ªè‡ªå·±å®šä¹‰çš„å‡½æ•°å‡½æ•°ï¼Œä¾‹å¦‚

```javascript
function another_function(err,data){}
```

ç„¶åè°ƒç”¨

```javascript
statement1

some_function(param1,param2,another_function)

statement2
```

é‚£ä¹ˆ`some_function`ä¼šå’Œ`statement2`å¹¶è¡Œæ‰§è¡Œï¼Œ`some_function`æ‰§è¡Œå®Œåå°±ä¼šè°ƒç”¨`another_function`ç„¶åç»™`another_function`ä¼ ä¸¤ä¸ªä¸ªå‚æ•°`err`å’Œ`data`ã€‚nodejsä¸­å¸¦å›è°ƒçš„å‡½æ•°éƒ½æŠŠé”™è¯¯ä¿¡æ¯ä½œä¸ºå›è°ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›çš„æ•°æ®ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚å›è°ƒå‡½æ•°`another_function`ä¹Ÿå°†æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ã€‚

## äº‹ä»¶å¾ªç¯

å¼•å…¥æ¨¡å—ğŸ‘‡åˆ›å»ºå¯¹è±¡ğŸ‘‡

```javascript
var events = require('events');
var eventEmitter = new events.EventEmitter();
```

æŠŠæŸä¸ªäº‹ä»¶`'eventName'`ç»‘å®šåˆ°æŸä¸ªå‡½æ•°`eventHandler`ä¸Š

```javascript
eventEmitter.on('eventName', eventHandler);
```

ç„¶åå°±å¯ä»¥è§¦å‘äº‹ä»¶äº†ğŸ‘‡

```javascript
eventEmitter.emit('eventName');
```

### è§¦å‘äº‹ä»¶çš„å†…éƒ¨æœºåˆ¶æ˜¯ï¼Ÿ

![äº‹ä»¶å¾ªç¯](i/nodejs_1.jpg)

äº‹ä»¶å¾ªç¯ğŸ‘†æ¯æ¬¡`eventEmitter.emit`éƒ½ä¼šæœ‰ä¸€ä¸ªäº‹ä»¶åç§°ï¼ˆ'eventName'ï¼‰å…¥é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—çš„å¦ä¸€ç«¯æ˜¯ä¸€ç¾¤å¤„ç†å‡½æ•°ï¼ˆeventHandlerï¼‰åœ¨ä¸æ–­ä»é˜Ÿåˆ—ä¸­å–äº‹ä»¶è¿›è¡Œå¤„ç†ã€‚

### eventEmitterè¿˜æœ‰è¿™äº›åŠŸèƒ½ğŸ‘‡

```javascript
addListener(event, listener)
#ä¸ºæŒ‡å®šäº‹ä»¶æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨åˆ°ç›‘å¬å™¨æ•°ç»„çš„å°¾éƒ¨ã€‚

on(event, listener)
#ä¸ºæŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸² event å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚ 

once(event, listener)
#ä¸ºæŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªå•æ¬¡ç›‘å¬å™¨ï¼Œå³ ç›‘å¬å™¨æœ€å¤šåªä¼šè§¦å‘ä¸€æ¬¡ï¼Œè§¦å‘åç«‹åˆ»è§£é™¤è¯¥ç›‘å¬å™¨ã€‚

removeListener(event, listener)
#ç§»é™¤æŒ‡å®šäº‹ä»¶çš„æŸä¸ªç›‘å¬å™¨ï¼Œç›‘å¬å™¨å¿…é¡»æ˜¯è¯¥äº‹ä»¶å·²ç»æ³¨å†Œè¿‡çš„ç›‘å¬å™¨ã€‚
å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯äº‹ä»¶åç§°ï¼Œç¬¬äºŒä¸ªæ˜¯å›è°ƒå‡½æ•°åç§°ã€‚

removeAllListeners([event])
#ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ï¼Œ å¦‚æœæŒ‡å®šäº‹ä»¶ï¼Œåˆ™ç§»é™¤æŒ‡å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ã€‚

setMaxListeners(n)
#é»˜è®¤æƒ…å†µä¸‹ï¼Œ EventEmitters å¦‚æœä½ æ·»åŠ çš„ç›‘å¬å™¨è¶…è¿‡ 10 ä¸ªå°±ä¼šè¾“å‡ºè­¦å‘Šä¿¡æ¯ã€‚ setMaxListeners å‡½æ•°ç”¨äºæé«˜ç›‘å¬å™¨çš„é»˜è®¤é™åˆ¶çš„æ•°é‡ã€‚

emit(event, [arg1], [arg2], [...])
#æŒ‰ç›‘å¬å™¨çš„é¡ºåºæ‰§è¡Œæ‰§è¡Œæ¯ä¸ªç›‘å¬å™¨ï¼Œå¦‚æœäº‹ä»¶æœ‰æ³¨å†Œç›‘å¬è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚

listenerCount(emitter, event)
#è¿”å›æŒ‡å®šäº‹ä»¶çš„ç›‘å¬å™¨æ•°é‡ã€‚
```

### ç»§æ‰¿ EventEmitter

å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ä¸ä¼šç›´æ¥ä½¿ç”¨ EventEmitterï¼Œè€Œæ˜¯åœ¨å¯¹è±¡ä¸­ç»§æ‰¿å®ƒã€‚

åŒ…æ‹¬ fsã€netã€ http åœ¨å†…çš„ï¼Œåªè¦æ˜¯æ”¯æŒäº‹ä»¶å“åº”çš„æ ¸å¿ƒæ¨¡å—éƒ½æ˜¯ EventEmitter çš„å­ç±»ã€‚

ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼ŸåŸå› æœ‰ä¸¤ç‚¹ï¼š

* å…·æœ‰æŸä¸ªå®ä½“åŠŸèƒ½çš„å¯¹è±¡å®ç°äº‹ä»¶ç¬¦åˆè¯­ä¹‰ï¼Œ äº‹ä»¶çš„ç›‘å¬å’Œå‘ç”Ÿåº”è¯¥æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚

* JavaScript çš„å¯¹è±¡æœºåˆ¶æ˜¯åŸºäºåŸå‹çš„ï¼Œæ”¯æŒéƒ¨åˆ†å¤šé‡ç»§æ‰¿ï¼Œç»§æ‰¿EventEmitter ä¸ä¼šæ‰“ä¹±å¯¹è±¡åŸæœ‰çš„ç»§æ‰¿å…³ç³»ã€‚